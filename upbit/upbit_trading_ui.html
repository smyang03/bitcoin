<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—…ë¹„íŠ¸ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-item {
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .panel h2 {
            margin-bottom: 20px;
            color: #FFD700;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }

        .form-group input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #212529;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .chart-container {
            grid-column: span 2;
            height: 400px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .trading-log {
            grid-column: span 2;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .log-entry.success {
            border-left-color: #28a745;
        }

        .log-entry.warning {
            border-left-color: #ffc107;
        }

        .log-entry.error {
            border-left-color: #dc3545;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .profit-positive {
            color: #00ff00;
        }

        .profit-negative {
            color: #ff4444;
        }

        .claude-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .claude-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .claude-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .claude-indicator.inactive {
            background: #ff4444;
            animation: none;
        }

        .telegram-config {
            background: #0088cc;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 600px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .close {
            color: #fff;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #ccc;
        }

        .coin-row {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .coin-row:hover {
            background: rgba(255,255,255,0.05);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .chart-container,
            .trading-log {
                grid-column: span 1;
            }
            
            .status-bar {
                flex-direction: column;
            }
            
            .status-item {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸš€ ì—…ë¹„íŠ¸ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ</h1>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-value" id="currentBalance">â‚©1,000,000</div>
                    <div class="status-label">í˜„ì¬ ì”ê³ </div>
                </div>
                <div class="status-item">
                    <div class="status-value profit-positive" id="dailyPnL">+0.00%</div>
                    <div class="status-label">ì¼ì¼ ì†ìµ</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="activePositions">0</div>
                    <div class="status-label">í™œì„± í¬ì§€ì…˜</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="tradingStatus">ì¤‘ì§€ë¨</div>
                    <div class="status-label">ê±°ë˜ ìƒíƒœ</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="lastUpdate">--:--</div>
                    <div class="status-label">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
            <!-- TradingConfig ì„¤ì • -->
            <div class="panel">
                <h2>âš™ï¸ TradingConfig ì„¤ì •</h2>
                
                <!-- ìê¸ˆ ê´€ë¦¬ ì„¤ì • -->
                <h3 style="color: #FFD700; font-size: 1.2rem; margin: 20px 0 10px 0;">ğŸ’° ìê¸ˆ ê´€ë¦¬</h3>
                <div class="form-group">
                    <label>ì´ˆê¸° íˆ¬ì ê¸ˆì•¡ (ì›)</label>
                    <input type="number" id="initialAmount" value="1000000" min="10000" step="10000">
                    <small>initial_amount: ì‹¤ì œ ì”ê³ ë³´ë‹¤ ë§ì´ ì„¤ì •í•˜ë©´ ê±°ë˜ ì°¨ë‹¨</small>
                </div>
                
                <div class="form-group">
                    <label>ìµœì†Œ ê±°ë˜ ê¸ˆì•¡ (ì›)</label>
                    <input type="number" id="minTradeAmount" value="50000" min="5000" step="5000">
                    <small>min_trade_amount: 50,000ì› = 0.05</small>
                </div>
                
                <!-- ìˆ˜ìµë¥ /ì†ì‹¤ë¥  ì œí•œ -->
                <h3 style="color: #FFD700; font-size: 1.2rem; margin: 20px 0 10px 0;">ğŸ“Š ì†ìµ ì œí•œ</h3>
                <div class="form-group">
                    <label>ì¼ì¼ ìµœëŒ€ ìˆ˜ìµë¥  (%)</label>
                    <input type="number" id="maxDailyProfit" value="50" min="1" max="100" step="1">
                    <small>max_daily_profit: 50% ì…ë ¥ â†’ ì½”ë“œê°’ 0.5</small>
                </div>
                
                <div class="form-group">
                    <label>ì¼ì¼ ìµœëŒ€ ì†ì‹¤ë¥  (%)</label>
                    <input type="number" id="maxDailyLoss" value="3" min="1" max="20" step="0.1">
                    <small>max_daily_loss: 3% ì…ë ¥ â†’ ì½”ë“œê°’ 0.03</small>
                </div>
                
                <!-- í¬ì§€ì…˜ ê´€ë¦¬ -->
                <h3 style="color: #FFD700; font-size: 1.2rem; margin: 20px 0 10px 0;">ğŸ¯ í¬ì§€ì…˜ ê´€ë¦¬</h3>
                <div class="form-group">
                    <label>ìµœëŒ€ ë™ì‹œ í¬ì§€ì…˜ ìˆ˜</label>
                    <input type="number" id="maxPositions" value="5" min="1" max="10">
                    <small>max_positions: ë¦¬ìŠ¤í¬ ë¶„ì‚°ìš©</small>
                </div>
                
                <div class="form-group">
                    <label>ë‹¨ì¼ í¬ì§€ì…˜ ìµœëŒ€ ë¹„ì¤‘ (%)</label>
                    <input type="number" id="maxPositionSize" value="30" min="5" max="50" step="1">
                    <small>max_position_size: 30% ì…ë ¥ â†’ ì½”ë“œê°’ 0.3</small>
                </div>
                
                <div class="form-group">
                    <label>ì†ì ˆë§¤ ë¹„ìœ¨ (%)</label>
                    <input type="number" id="stopLossRate" value="2" min="0.5" max="10" step="0.1">
                    <small>stop_loss_rate: 2% ì…ë ¥ â†’ ì½”ë“œê°’ 0.02</small>
                </div>
                
                <!-- ëª¨ë“œ ì„¤ì • -->
                <h3 style="color: #FFD700; font-size: 1.2rem; margin: 20px 0 10px 0;">ğŸ”§ ëª¨ë“œ ì„¤ì •</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="paperTrading" checked> 
                        ëª¨ì˜ê±°ë˜ ëª¨ë“œ (paper_trading)
                    </label>
                    <small>ì²´í¬ í•´ì œì‹œ ì‹¤ì œ ê±°ë˜ - ì£¼ì˜!</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="dailyTradeLimit"> 
                        í•˜ë£¨ 1íšŒ ê±°ë˜ ì œí•œ (daily_trade_limit)
                    </label>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="compoundInterest" checked> 
                        ë³µë¦¬ ê³„ì‚° (compound_interest)
                    </label>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="includeFees" checked> 
                        ìˆ˜ìˆ˜ë£Œ í¬í•¨ ê³„ì‚° (include_fees)
                    </label>
                    <small>upbit_fee_rate: 0.0005 (0.05%)</small>
                </div>
                
                <!-- AI & ì•Œë¦¼ ì„¤ì • -->
                <h3 style="color: #FFD700; font-size: 1.2rem; margin: 20px 0 10px 0;">ğŸ¤– AI & ì•Œë¦¼</h3>
                <div class="form-group">
                    <label>Claude ê°œì… ì£¼ê¸° (ë¶„)</label>
                    <input type="number" id="claudeInterval" value="30" min="5" max="240" step="5">
                    <small>claude_interval: AI ë¶„ì„ ì£¼ê¸°</small>
                </div>
                
                <div class="form-group">
                    <label>í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì£¼ê¸° (ë¶„)</label>
                    <input type="number" id="telegramInterval" value="30" min="5" max="120" step="5">
                    <small>telegram_interval: ì •ê¸° ë¦¬í¬íŠ¸ ì£¼ê¸°</small>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-success" onclick="saveTradingConfig()">ì„¤ì • ì €ì¥</button>
                    <button class="btn btn-primary" onclick="loadTradingConfig()">ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <button class="btn btn-warning" onclick="resetToDefault()">ê¸°ë³¸ê°’ ë³µì›</button>
                </div>
            </div>

            <!-- API í‚¤ ì„¤ì • -->
            <div class="panel">
                <h2>ğŸ”‘ ì—…ë¹„íŠ¸ API ì„¤ì •</h2>
                <div class="form-group">
                    <label>Access Key</label>
                    <input type="password" id="accessKey" placeholder="ì—…ë¹„íŠ¸ Access Key ì…ë ¥">
                </div>
                <div class="form-group">
                    <label>Secret Key</label>
                    <input type="password" id="secretKey" placeholder="ì—…ë¹„íŠ¸ Secret Key ì…ë ¥">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                    <button class="btn btn-success" onclick="saveApiKeys()">ì €ì¥</button>
                </div>
                <div id="apiStatus" style="margin-top: 10px;"></div>
            </div>

            <!-- Claude ê°œì… ì„¤ì • -->
            <div class="panel claude-panel">
                <h2>ğŸ¤– Claude AI ê°œì… ì„¤ì •</h2>
                <div class="claude-status">
                    <div class="claude-indicator" id="claudeIndicator"></div>
                    <span>Claude AI í™œì„±</span>
                </div>
                <div class="form-group">
                    <label>ê°œì… ì£¼ê¸°</label>
                    <select id="claudeIntervalSelect">
                        <option value="10">10ë¶„ë§ˆë‹¤</option>
                        <option value="30" selected>30ë¶„ë§ˆë‹¤</option>
                        <option value="60">1ì‹œê°„ë§ˆë‹¤</option>
                        <option value="120">2ì‹œê°„ë§ˆë‹¤</option>
                        <option value="240">4ì‹œê°„ë§ˆë‹¤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="claudeEmergencyMode" checked> 
                        ê¸´ê¸‰ ìƒí™© ìë™ ê°œì…
                    </label>
                </div>
                <div class="form-group">
                    <label>ìœ„í—˜ë„ ì„ê³„ê°’</label>
                    <input type="range" id="riskThreshold" min="0.1" max="1.0" step="0.1" value="0.7">
                    <span id="riskThresholdValue">0.7</span>
                </div>
                <div class="form-group">
                    <button class="btn btn-warning" onclick="claudeManualAnalysis()">ìˆ˜ë™ ë¶„ì„ ìš”ì²­</button>
                    <button class="btn btn-danger" onclick="claudeEmergencyStop()">ê¸´ê¸‰ ì¤‘ì§€</button>
                </div>
            </div>

            <!-- í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì„¤ì • -->
            <div class="panel telegram-config">
                <h2>ğŸ“± í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì„¤ì •</h2>
                <div class="form-group">
                    <label>ë´‡ í† í°</label>
                    <input type="password" id="telegramToken" placeholder="í…”ë ˆê·¸ë¨ ë´‡ í† í° ì…ë ¥">
                </div>
                <div class="form-group">
                    <label>ì±„íŒ… ID</label>
                    <input type="text" id="telegramChatId" placeholder="í…”ë ˆê·¸ë¨ ì±„íŒ… ID ì…ë ¥">
                </div>
                <div class="form-group">
                    <label>ì•Œë¦¼ ì£¼ê¸°</label>
                    <select id="notificationInterval">
                        <option value="5">5ë¶„ë§ˆë‹¤</option>
                        <option value="10">10ë¶„ë§ˆë‹¤</option>
                        <option value="30" selected>30ë¶„ë§ˆë‹¤</option>
                        <option value="60">1ì‹œê°„ë§ˆë‹¤</option>
                        <option value="120">2ì‹œê°„ë§ˆë‹¤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì•Œë¦¼ ë‚´ìš©</label>
                    <div>
                        <label><input type="checkbox" id="notifyProfitLoss" checked> ì†ìµ ì •ë³´</label><br>
                        <label><input type="checkbox" id="notifyTrades" checked> ê±°ë˜ ë‚´ì—­</label><br>
                        <label><input type="checkbox" id="notifyAlerts" checked> ê²½ê³  ì•Œë¦¼</label><br>
                        <label><input type="checkbox" id="notifyClaudeActions" checked> Claude ê°œì…</label>
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="testTelegram()">í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€</button>
                    <button class="btn btn-success" onclick="saveTelegramConfig()">ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- ì—…ë¹„íŠ¸ ì½”ì¸ ëª©ë¡ ë° ì„ íƒ -->
        <div class="panel" style="grid-column: span 2;">
            <h2>ğŸª™ ì—…ë¹„íŠ¸ ì½”ì¸ ëª©ë¡ ë° ì„ íƒ</h2>
            
            <!-- ì½”ì¸ ë¡œë”© ë° ìƒˆë¡œê³ ì¹¨ -->
            <div class="form-group">
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="loadUpbitCoins()">ì½”ì¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-success" onclick="selectAllCoins()">ì „ì²´ ì„ íƒ</button>
                    <button class="btn btn-warning" onclick="clearAllCoins()">ì „ì²´ í•´ì œ</button>
                    <button class="btn" style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;" onclick="getAIRecommendations()">ğŸ¤– AI ì¶”ì²œ</button>
                    <span id="coinLoadStatus" style="color: #ccc;"></span>
                </div>
                
                <!-- ê²€ìƒ‰ ë° í•„í„° -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="coinSearch" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: BTC, ë¹„íŠ¸ì½”ì¸)" 
                           style="flex: 1; padding: 8px;" oninput="filterCoins()">
                    <select id="sortBy" onchange="sortCoins()" style="padding: 8px;">
                        <option value="name">ì´ë¦„ìˆœ</option>
                        <option value="price">ê°€ê²©ìˆœ</option>
                        <option value="change">ë³€ë™ë¥ ìˆœ</option>
                        <option value="volume">ê±°ë˜ëŸ‰ìˆœ</option>
                    </select>
                </div>
            </div>
            
            <!-- ì½”ì¸ ëª©ë¡ í…Œì´ë¸” -->
            <div id="coinListContainer" style="max-height: 500px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.3); border-radius: 8px;">
                <table id="coinTable" style="width: 100%; border-collapse: collapse;">
                    <thead style="background: rgba(255,255,255,0.1); position: sticky; top: 0;">
                        <tr>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ì„ íƒ</th>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ì½”ì¸</th>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">í˜„ì¬ê°€</th>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">24h ë³€ë™ë¥ </th>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">24h ê±°ë˜ëŸ‰</th>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ì‹œì¥ë°ì´í„°</th>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ê¸°ìˆ ì§€í‘œ</th>
                            <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ì‹ í˜¸</th>
                        </tr>
                    </thead>
                    <tbody id="coinTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #ccc;">
                                "ì½”ì¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—…ë¹„íŠ¸ ì½”ì¸ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- ì„ íƒëœ ì½”ì¸ ìš”ì•½ -->
            <div id="selectedSummary" style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
                <h4>ì„ íƒëœ ì½”ì¸ (<span id="selectedCount">0</span>ê°œ)</h4>
                <div id="selectedCoins" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                    <!-- ì„ íƒëœ ì½”ì¸ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œ -->
                </div>
            </div>
        </div>

        <!-- ìˆ˜ìµë¥  ì°¨íŠ¸ -->
        <div class="chart-container">
            <h2>ğŸ“Š ì‹¤ì‹œê°„ ìˆ˜ìµë¥  ì°¨íŠ¸</h2>
            <canvas id="profitChart"></canvas>
        </div>

        <!-- ì„ íƒëœ ì½”ì¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„° -->
        <div class="panel" style="grid-column: span 2;">
            <h2>ğŸ‘ï¸ ì„ íƒëœ ì½”ì¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°</h2>
            <div id="selectedCoinsMonitor">
                <div id="noSelectedCoins" style="text-align: center; padding: 40px; color: #ccc;">
                    ì½”ì¸ì„ ì„ íƒí•˜ë©´ ì—¬ê¸°ì— ì‹¤ì‹œê°„ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤
                </div>
                <div id="selectedCoinsGrid" style="display: none; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <!-- ì„ íƒëœ ì½”ì¸ë“¤ì˜ ì¹´ë“œê°€ ì—¬ê¸°ì— í‘œì‹œ -->
                </div>
            </div>
        </div>

        <!-- ìƒì„¸ í¬ì§€ì…˜ í˜„í™© -->
        <div class="panel" style="grid-column: span 2;">
            <h2>ğŸ’¼ ìƒì„¸ í¬ì§€ì…˜ í˜„í™©</h2>
            <div id="positionDetails">
                <!-- í¬ì§€ì…˜ì´ ì—†ì„ ë•Œ -->
                <div id="noPositions" style="text-align: center; padding: 40px; color: #ccc;">
                    í˜„ì¬ ë³´ìœ  ì¤‘ì¸ í¬ì§€ì…˜ì´ ì—†ìŠµë‹ˆë‹¤
                </div>
                
                <!-- í¬ì§€ì…˜ í…Œì´ë¸” -->
                <div id="positionTable" style="display: none;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(255,255,255,0.1);">
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ì½”ì¸</th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ë³´ìœ ëŸ‰</th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ë§¤ìˆ˜ í‰ê· ê°€</th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">í˜„ì¬ê°€</th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">íˆ¬ìê¸ˆì•¡</th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">í‰ê°€ê¸ˆì•¡</th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">í‰ê°€ì†ìµ</th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ìˆ˜ìµë¥ </th>
                                <th style="padding: 12px; border: 1px solid rgba(255,255,255,0.2);">ì•¡ì…˜</th>
                            </tr>
                        </thead>
                        <tbody id="positionTableBody">
                            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                        </tbody>
                    </table>
                </div>
                
                <!-- í¬ì§€ì…˜ ìš”ì•½ -->
                <div id="positionSummary" style="margin-top: 20px; display: none;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="status-item">
                            <div class="status-value" id="totalInvested">â‚©0</div>
                            <div class="status-label">ì´ íˆ¬ìê¸ˆì•¡</div>
                        </div>
                        <div class="status-item">
                            <div class="status-value" id="totalValue">â‚©0</div>
                            <div class="status-label">ì´ í‰ê°€ê¸ˆì•¡</div>
                        </div>
                        <div class="status-item">
                            <div class="status-value" id="totalPnL">â‚©0</div>
                            <div class="status-label">ì´ í‰ê°€ì†ìµ</div>
                        </div>
                        <div class="status-item">
                            <div class="status-value" id="totalPnLRate">0.00%</div>
                            <div class="status-label">ì´ ìˆ˜ìµë¥ </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê±°ë˜ ì œì–´ -->
        <div class="panel" style="grid-column: span 2;">
            <h2>ğŸ® ê±°ë˜ ì œì–´</h2>
            <div class="controls">
                <button class="btn btn-success" id="startBtn" onclick="startTrading()">ê±°ë˜ ì‹œì‘</button>
                <button class="btn btn-danger" id="stopBtn" onclick="stopTrading()" disabled>ê±°ë˜ ì¤‘ì§€</button>
                <button class="btn btn-warning" onclick="pauseTrading()">ì¼ì‹œ ì •ì§€</button>
                <button class="btn btn-danger" onclick="emergencySell()">ê¸´ê¸‰ ë§¤ë„</button>
                <button class="btn btn-primary" onclick="resetDaily()">ì¼ì¼ ë¦¬ì…‹</button>
            </div>
            <div style="margin-top: 20px;">
                <label>ìˆ˜ìˆ˜ë£Œ í¬í•¨ ìˆ˜ìµë¥  ê³„ì‚°: </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="includeFeesToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- ê±°ë˜ ë¡œê·¸ -->
        <div class="trading-log">
            <h2>ğŸ“ˆ ê±°ë˜ ë¡œê·¸</h2>
            <div id="logContainer">
                <div class="log-entry">
                    <strong>[ì‹œìŠ¤í…œ]</strong> ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ ì°½ë“¤ -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('settingsModal')">&times;</span>
            <h2>ê³ ê¸‰ ì„¤ì •</h2>
            <div class="form-group">
                <label>ìµœëŒ€ ë™ì‹œ í¬ì§€ì…˜ ìˆ˜</label>
                <input type="number" id="maxPositionsModal" value="4" min="1" max="10">
            </div>
            <div class="form-group">
                <label>ë‹¨ì¼ í¬ì§€ì…˜ ìµœëŒ€ ë¹„ì¤‘ (%)</label>
                <input type="number" id="maxPositionSizeModal" value="25" min="5" max="50">
            </div>
            <div class="form-group">
                <label>ì†ì ˆë§¤ ë¹„ìœ¨ (%)</label>
                <input type="number" id="stopLossRateModal" value="1" min="0.5" max="5" step="0.1">
            </div>
            <button class="btn btn-success" onclick="saveAdvancedSettings()">ì €ì¥</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let tradingBot = {
            isRunning: false,
            dailyPnL: 0,
            positions: {},
            balance: 1000000,
            initialBalance: 1000000,
            trades: [],
            claudeActive: true,
            lastUpdate: new Date()
        };

        let profitChart;
        let chartData = {
            labels: [],
            datasets: [{
                label: 'ì¼ì¼ ìˆ˜ìµë¥  (%)',
                data: [],
                borderColor: '#00ff00',
                backgroundColor: 'rgba(0, 255, 0, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };

        let upbitCoins = [];
        let coinPrices = {};
        let coinAnalysis = {};

        // API í˜¸ì¶œ ê³µí†µ í•¨ìˆ˜
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(endpoint, options);
                const result = await response.json();
                
                if (!result.success && result.message) {
                    throw new Error(result.message);
                }
                
                return result;
            } catch (error) {
                console.error(`API í˜¸ì¶œ ì˜¤ë¥˜ (${endpoint}):`, error);
                throw error;
            }
        }

        // ì°¨íŠ¸ ì´ˆê¸°í™”
        function initChart() {
            const ctx = document.getElementById('profitChart').getContext('2d');
            profitChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
            
            // ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ
            loadChartData();
        }

        // ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ
        async function loadChartData() {
            try {
                const result = await apiCall('/api/profit_chart');
                if (result.success && result.data) {
                    chartData.labels = result.data.labels;
                    chartData.datasets[0].data = result.data.profits;
                    profitChart.update();
                }
            } catch (error) {
                console.error('ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // TradingConfig ê´€ë ¨ í•¨ìˆ˜ë“¤
        async function saveTradingConfig() {
            const selectedCoins = Array.from(document.querySelectorAll('input[id^="coin_"]:checked'))
                                      .map(cb => cb.value);
            
            const config = {
                initial_amount: parseFloat(document.getElementById('initialAmount').value),
                min_trade_amount: parseFloat(document.getElementById('minTradeAmount').value),
                max_daily_profit: parseFloat(document.getElementById('maxDailyProfit').value),
                max_daily_loss: parseFloat(document.getElementById('maxDailyLoss').value),
                max_positions: parseInt(document.getElementById('maxPositions').value),
                max_position_size: parseFloat(document.getElementById('maxPositionSize').value),
                stop_loss_rate: parseFloat(document.getElementById('stopLossRate').value),
                paper_trading: document.getElementById('paperTrading').checked,
                daily_trade_limit: document.getElementById('dailyTradeLimit').checked,
                compound_interest: document.getElementById('compoundInterest').checked,
                include_fees: document.getElementById('includeFees').checked,
                claude_interval: parseInt(document.getElementById('claudeInterval').value),
                telegram_interval: parseInt(document.getElementById('telegramInterval').value),
                target_coins: selectedCoins
            };
            
            try {
                const result = await apiCall('/api/config', 'POST', config);
                addLog(`âœ… ì„¤ì • ì €ì¥ì™„ë£Œ (ì„ íƒëœ ì½”ì¸: ${selectedCoins.length}ê°œ)`, 'success');
                alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                addLog('âŒ ì„¤ì • ì €ì¥ ì‹¤íŒ¨', 'error');
                alert('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function loadTradingConfig() {
            try {
                const result = await apiCall('/api/config');
                if (result.success && result.config) {
                    const config = result.config;
                    
                    document.getElementById('initialAmount').value = config.initial_amount || 1000000;
                    document.getElementById('minTradeAmount').value = config.min_trade_amount || 50000;
                    document.getElementById('maxDailyProfit').value = config.max_daily_profit || 50;
                    document.getElementById('maxDailyLoss').value = config.max_daily_loss || 3;
                    document.getElementById('maxPositions').value = config.max_positions || 5;
                    document.getElementById('maxPositionSize').value = config.max_position_size || 30;
                    document.getElementById('stopLossRate').value = config.stop_loss_rate || 2;
                    document.getElementById('paperTrading').checked = config.paper_trading !== false;
                    document.getElementById('dailyTradeLimit').checked = config.daily_trade_limit || false;
                    document.getElementById('compoundInterest').checked = config.compound_interest !== false;
                    document.getElementById('includeFees').checked = config.include_fees !== false;
                    document.getElementById('claudeInterval').value = config.claude_interval || 30;
                    document.getElementById('telegramInterval').value = config.telegram_interval || 30;
                    
                    // íƒ€ê²Ÿ ì½”ì¸ ì²´í¬ë°•ìŠ¤ ì„¤ì •
                    if (config.target_coins) {
                        document.querySelectorAll('input[type="checkbox"][value^="KRW-"]').forEach(cb => {
                            cb.checked = config.target_coins.includes(cb.value);
                        });
                        updateSelectedCoins();
                    }
                    
                    addLog('ğŸ“¥ TradingConfig ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
                } else {
                    addLog('âš ï¸ ì €ì¥ëœ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                }
            } catch (error) {
                addLog('âŒ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        // ì—…ë¹„íŠ¸ ì½”ì¸ ëª©ë¡ ë¡œë“œ
        async function loadUpbitCoins() {
            try {
                document.getElementById('coinLoadStatus').textContent = 'ì½”ì¸ ëª©ë¡ ë¡œë”© ì¤‘...';
                addLog('ì—…ë¹„íŠ¸ ì½”ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');

                // 1. ì—…ë¹„íŠ¸ ë§ˆì¼“ ì½”ë“œ ì¡°íšŒ
                const marketResponse = await fetch('https://api.upbit.com/v1/market/all?isDetails=true');
                const markets = await marketResponse.json();

                // KRW ë§ˆì¼“ë§Œ í•„í„°ë§
                const krwMarkets = markets.filter(market => market.market.startsWith('KRW-'));

                // 2. í˜„ì¬ê°€ ì •ë³´ ì¡°íšŒ
                const symbols = krwMarkets.map(m => m.market).join(',');
                const tickerResponse = await fetch(`https://api.upbit.com/v1/ticker?markets=${symbols}`);
                const tickers = await tickerResponse.json();

                // 3. ì½”ì¸ ë°ì´í„° ê²°í•©
                upbitCoins = krwMarkets.map(market => {
                    const ticker = tickers.find(t => t.market === market.market);
                    return {
                        market: market.market,
                        korean_name: market.korean_name,
                        english_name: market.english_name,
                        current_price: ticker ? ticker.trade_price : 0,
                        change: ticker ? ticker.change : 'EVEN',
                        change_rate: ticker ? ticker.change_rate : 0,
                        acc_trade_price_24h: ticker ? ticker.acc_trade_price_24h : 0,
                        high_price: ticker ? ticker.high_price : 0,
                        low_price: ticker ? ticker.low_price : 0,
                        prev_closing_price: ticker ? ticker.prev_closing_price : 0
                    };
                }).filter(coin => coin.acc_trade_price_24h > 0); // ê±°ë˜ëŸ‰ ìˆëŠ” ê²ƒë§Œ

                document.getElementById('coinLoadStatus').textContent = `${upbitCoins.length}ê°œ ì½”ì¸ ë¡œë“œ ì™„ë£Œ`;
                addLog(`ì—…ë¹„íŠ¸ ì½”ì¸ ${upbitCoins.length}ê°œ ë¡œë“œ ì™„ë£Œ`, 'success');

                // 4. ì½”ì¸ ë¶„ì„ ìˆ˜í–‰
                document.getElementById('coinLoadStatus').textContent = 'ì½”ì¸ ë¶„ì„ ì¤‘...';
                await analyzeCoins();

                // 5. í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateCoinTable();

                document.getElementById('coinLoadStatus').textContent = `âœ… ì™„ë£Œ (${upbitCoins.length}ê°œ)`;
                addLog(`âœ… ì½”ì¸ ë¶„ì„ ì™„ë£Œ`, 'success');

            } catch (error) {
                console.error('ì½”ì¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                addLog('âŒ ì½”ì¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
                document.getElementById('coinLoadStatus').textContent = 'ë¡œë“œ ì‹¤íŒ¨';
            }
        }

        // ì½”ì¸ ë¶„ì„ (ì‹œì¥ë°ì´í„° + ê¸°ìˆ ì§€í‘œ)
        async function analyzeCoins() {
            const analysisPromises = upbitCoins.slice(0, 50).map(async (coin) => {
                try {
                    // ìº”ë“¤ ë°ì´í„° ì¡°íšŒ (ì¼ë´‰ 30ì¼)
                    const candleResponse = await fetch(
                        `https://api.upbit.com/v1/candles/days?market=${coin.market}&count=30`
                    );
                    const candles = await candleResponse.json();
                    
                    if (candles.length < 14) return;
                    
                    // ê¸°ìˆ ì§€í‘œ ê³„ì‚°
                    const prices = candles.map(c => c.trade_price).reverse();
                    const volumes = candles.map(c => c.candle_acc_trade_volume).reverse();
                    
                    const rsi = calculateRSI(prices, 14);
                    const ma20 = calculateMA(prices, 20);
                    const ma50 = prices.length >= 50 ? calculateMA(prices, 50) : ma20;
                    const volumeAvg = calculateMA(volumes, 7);
                    const currentVolume = volumes[volumes.length - 1];
                    
                    // ì‹œì¥ ë°ì´í„°
                    const marketData = {
                        volatility: calculateVolatility(prices),
                        volume_ratio: volumeAvg > 0 ? currentVolume / volumeAvg : 1,
                        trend: prices[prices.length - 1] > ma20 ? 'UP' : 'DOWN'
                    };
                    
                    // ê¸°ìˆ ì§€í‘œ
                    const indicators = {
                        rsi: rsi,
                        ma_trend: prices[prices.length - 1] > ma20 && ma20 > ma50 ? 'BULLISH' : 
                                 prices[prices.length - 1] < ma20 && ma20 < ma50 ? 'BEARISH' : 'NEUTRAL'
                    };
                    
                    // ì‹ í˜¸ ìƒì„±
                    let signal = 'HOLD';
                    if (rsi < 30 && marketData.trend === 'DOWN' && marketData.volume_ratio > 1.2) {
                        signal = 'BUY';
                    } else if (rsi > 70 && marketData.trend === 'UP' && marketData.volume_ratio > 1.2) {
                        signal = 'SELL';
                    }
                    
                    coinAnalysis[coin.market] = {
                        marketData,
                        indicators,
                        signal
                    };
                    
                } catch (error) {
                    console.error(`${coin.market} ë¶„ì„ ì‹¤íŒ¨:`, error);
                }
            });
            
            await Promise.all(analysisPromises);
        }

        // ê¸°ìˆ ì§€í‘œ ê³„ì‚° í•¨ìˆ˜ë“¤
        function calculateRSI(prices, period = 14) {
            if (prices.length < period + 1) return 50;
            
            let gains = 0, losses = 0;
            
            for (let i = 1; i <= period; i++) {
                const change = prices[i] - prices[i-1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        function calculateMA(values, period) {
            if (values.length < period) return values[values.length - 1] || 0;
            
            const sum = values.slice(-period).reduce((a, b) => a + b, 0);
            return sum / period;
        }

        function calculateVolatility(prices) {
            if (prices.length < 2) return 0;
            
            const changes = prices.slice(1).map((price, i) => 
                Math.abs((price - prices[i]) / prices[i])
            );
            
            return changes.reduce((a, b) => a + b, 0) / changes.length;
        }

        // ì½”ì¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateCoinTable() {
            const tbody = document.getElementById('coinTableBody');
            tbody.innerHTML = '';
            
            upbitCoins.forEach(coin => {
                const row = document.createElement('tr');
                row.className = 'coin-row';
                row.dataset.market = coin.market;
                
                const changeColor = coin.change === 'RISE' ? '#ff4444' : 
                                   coin.change === 'FALL' ? '#4444ff' : '#ccc';
                
                const analysis = coinAnalysis[coin.market] || {};
                const marketData = analysis.marketData || {};
                const indicators = analysis.indicators || {};
                
                // ì‹œì¥ë°ì´í„° í‘œì‹œ
                const marketInfo = `
                    <div style="font-size: 0.8rem;">
                        <div>ë³€ë™ì„±: ${(marketData.volatility * 100).toFixed(1)}%</div>
                        <div>ê±°ë˜ëŸ‰ë¹„: ${marketData.volume_ratio ? marketData.volume_ratio.toFixed(1) : '1.0'}x</div>
                        <div>ì¶”ì„¸: <span style="color: ${marketData.trend === 'UP' ? '#00ff00' : '#ff4444'}">${marketData.trend || 'NEUTRAL'}</span></div>
                    </div>
                `;
                
                // ê¸°ìˆ ì§€í‘œ í‘œì‹œ
                const indicatorInfo = `
                    <div style="font-size: 0.8rem;">
                        <div>RSI: ${indicators.rsi ? indicators.rsi.toFixed(1) : '50.0'}</div>
                        <div>MAì¶”ì„¸: <span style="color: ${
                            indicators.ma_trend === 'BULLISH' ? '#00ff00' : 
                            indicators.ma_trend === 'BEARISH' ? '#ff4444' : '#ccc'
                        }">${indicators.ma_trend || 'NEUTRAL'}</span></div>
                    </div>
                `;
                
                // ì‹ í˜¸ í‘œì‹œ
                const signalColor = analysis.signal === 'BUY' ? '#00ff00' : 
                                   analysis.signal === 'SELL' ? '#ff4444' : '#ccc';
                
                row.innerHTML = `
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                        <input type="checkbox" id="coin_${coin.market}" value="${coin.market}" onchange="updateSelectedCoins()">
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="font-weight: bold;">${coin.market.replace('KRW-', '')}</div>
                        <div style="font-size: 0.8rem; color: #ccc;">${coin.korean_name}</div>
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2); text-align: right; font-weight: bold;">
                        â‚©${coin.current_price.toLocaleString()}
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2); text-align: right; color: ${changeColor}; font-weight: bold;">
                        ${(coin.change_rate * 100).toFixed(2)}%
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2); text-align: right;">
                        â‚©${Math.round(coin.acc_trade_price_24h / 1000000).toLocaleString()}M
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">${marketInfo}</td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">${indicatorInfo}</td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                        <span style="color: ${signalColor}; font-weight: bold; padding: 4px 8px; border-radius: 4px; background: rgba(255,255,255,0.1);">
                            ${analysis.signal || 'HOLD'}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ì¶”ì²œ ì½”ì¸ ì„ íƒ (ê°„ë‹¨í•œ ê±°ë˜ëŸ‰ ê¸°ë°˜)
        function selectRecommendedCoins() {
            document.querySelectorAll('input[id^="coin_"]').forEach(cb => cb.checked = false);

            const recommended = upbitCoins
                .filter(coin => coin.acc_trade_price_24h > 1000000000)
                .sort((a, b) => b.acc_trade_price_24h - a.acc_trade_price_24h)
                .slice(0, 15);

            recommended.forEach(coin => {
                const checkbox = document.getElementById(`coin_${coin.market}`);
                if (checkbox) checkbox.checked = true;
            });

            updateSelectedCoins();
            addLog(`âœ… ì¶”ì²œ ì½”ì¸ ${recommended.length}ê°œ ì„ íƒë¨`, 'success');
        }

        // AI ê¸°ë°˜ ì½”ì¸ ì¶”ì²œ (ì‹œì¥ ë¶„ì„)
        async function getAIRecommendations() {
            if (upbitCoins.length === 0) {
                alert('ë¨¼ì € ì½”ì¸ ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
                return;
            }

            addLog('ğŸ¤– AIê°€ ì‹œì¥ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
            document.getElementById('coinLoadStatus').textContent = 'AI ë¶„ì„ ì¤‘...';

            try {
                // ê° ì½”ì¸ì— ëŒ€í•œ ì ìˆ˜ ê³„ì‚°
                const scoredCoins = upbitCoins
                    .filter(coin => {
                        const analysis = coinAnalysis[coin.market];
                        return analysis && coin.acc_trade_price_24h > 500000000; // ìµœì†Œ ê±°ë˜ëŸ‰ í•„í„°
                    })
                    .map(coin => {
                        const analysis = coinAnalysis[coin.market];
                        let score = 0;
                        let reasons = [];

                        // 1. RSI ê¸°ë°˜ ì ìˆ˜ (ê³¼ë§¤ë„ êµ¬ê°„ ì„ í˜¸)
                        if (analysis.indicators.rsi < 30) {
                            score += 40;
                            reasons.push('RSI ê³¼ë§¤ë„');
                        } else if (analysis.indicators.rsi < 40) {
                            score += 20;
                            reasons.push('RSI ì €í‰ê°€');
                        } else if (analysis.indicators.rsi > 70) {
                            score -= 30;
                            reasons.push('RSI ê³¼ë§¤ìˆ˜');
                        }

                        // 2. ì´ë™í‰ê·  ì¶”ì„¸
                        if (analysis.indicators.ma_trend === 'BULLISH') {
                            score += 25;
                            reasons.push('ìƒìŠ¹ì¶”ì„¸');
                        } else if (analysis.indicators.ma_trend === 'BEARISH') {
                            score -= 15;
                        }

                        // 3. ê±°ë˜ëŸ‰ ê¸‰ì¦
                        if (analysis.marketData.volume_ratio > 2.0) {
                            score += 30;
                            reasons.push('ê±°ë˜ëŸ‰ ê¸‰ì¦');
                        } else if (analysis.marketData.volume_ratio > 1.5) {
                            score += 15;
                            reasons.push('ê±°ë˜ëŸ‰ ì¦ê°€');
                        }

                        // 4. ë³€ë™ì„± (ì ë‹¹í•œ ë³€ë™ì„± ì„ í˜¸)
                        const volatility = analysis.marketData.volatility;
                        if (volatility > 0.03 && volatility < 0.08) {
                            score += 20;
                            reasons.push('ì ì ˆí•œ ë³€ë™ì„±');
                        } else if (volatility > 0.15) {
                            score -= 20;
                            reasons.push('ë³€ë™ì„± ê³¼ë‹¤');
                        }

                        // 5. 24ì‹œê°„ ë³€ë™ë¥  (ì ë‹¹í•œ í•˜ë½ í›„ ë°˜ë“± ê°€ëŠ¥ì„±)
                        if (coin.change_rate < 0 && coin.change_rate > -0.05) {
                            score += 15;
                            reasons.push('ë°˜ë“± ê°€ëŠ¥ì„±');
                        } else if (coin.change_rate > 0.1) {
                            score -= 10; // ê¸‰ë“± í›„ ì¡°ì • ê°€ëŠ¥ì„±
                        }

                        // 6. ê±°ë˜ëŒ€ê¸ˆ (ìœ ë™ì„±)
                        if (coin.acc_trade_price_24h > 10000000000) {
                            score += 10;
                            reasons.push('ë†’ì€ ìœ ë™ì„±');
                        }

                        // 7. ì‹ í˜¸ ê°•ë„
                        if (analysis.signal === 'BUY') {
                            score += 35;
                            reasons.push('ë§¤ìˆ˜ ì‹ í˜¸');
                        } else if (analysis.signal === 'SELL') {
                            score -= 25;
                        }

                        return {
                            coin,
                            score,
                            reasons,
                            analysis
                        };
                    })
                    .filter(item => item.score > 50) // ìµœì†Œ ì ìˆ˜ í•„í„°
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 12); // ìƒìœ„ 12ê°œ

                if (scoredCoins.length === 0) {
                    addLog('âš ï¸ í˜„ì¬ ì‹œì¥ ìƒí™©ì—ì„œ ì¶”ì²œí•  ë§Œí•œ ì½”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    document.getElementById('coinLoadStatus').textContent = 'ì¶”ì²œ ì½”ì¸ ì—†ìŒ';
                    return;
                }

                // ê¸°ì¡´ ì„ íƒ í•´ì œ
                document.querySelectorAll('input[id^="coin_"]').forEach(cb => cb.checked = false);

                // AI ì¶”ì²œ ì½”ì¸ ì„ íƒ
                scoredCoins.forEach(item => {
                    const checkbox = document.getElementById(`coin_${item.coin.market}`);
                    if (checkbox) checkbox.checked = true;
                });

                updateSelectedCoins();

                // ì¶”ì²œ ì´ìœ  ë¡œê·¸
                addLog(`ğŸ¤– AIê°€ ${scoredCoins.length}ê°œ ì½”ì¸ì„ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤:`, 'success');
                scoredCoins.slice(0, 5).forEach((item, index) => {
                    const coinName = item.coin.market.replace('KRW-', '');
                    const reasonText = item.reasons.slice(0, 3).join(', ');
                    addLog(`${index + 1}. ${coinName} (ì ìˆ˜: ${item.score.toFixed(0)}) - ${reasonText}`, 'info');
                });

                document.getElementById('coinLoadStatus').textContent = `âœ… AI ì¶”ì²œ ì™„ë£Œ (${scoredCoins.length}ê°œ)`;

                // ì¶”ì²œ ìš”ì•½ í‘œì‹œ
                showAIRecommendationSummary(scoredCoins);

            } catch (error) {
                console.error('AI ì¶”ì²œ ì˜¤ë¥˜:', error);
                addLog('âŒ AI ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                document.getElementById('coinLoadStatus').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
            }
        }

        // AI ì¶”ì²œ ìš”ì•½ í‘œì‹œ
        function showAIRecommendationSummary(scoredCoins) {
            const summaryHtml = `
                <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px; border: 2px solid #667eea;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ¤– AI ì¶”ì²œ ë¶„ì„ ê²°ê³¼</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px;">
                            <div style="font-size: 0.9rem; color: #ccc;">ì¶”ì²œ ì½”ì¸ ìˆ˜</div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #667eea;">${scoredCoins.length}ê°œ</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px;">
                            <div style="font-size: 0.9rem; color: #ccc;">í‰ê·  ì‹ ë¢°ë„</div>
                            <div style="font-size: 1.3rem; font-weight: bold; color: #00ff00;">${(scoredCoins.reduce((sum, item) => sum + item.score, 0) / scoredCoins.length).toFixed(0)}ì </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px;">
                            <div style="font-size: 0.9rem; color: #ccc;">ì‹œì¥ ìƒí™©</div>
                            <div style="font-size: 1.1rem; font-weight: bold; color: #ffa500;">
                                ${scoredCoins.filter(item => item.analysis.marketData.trend === 'UP').length > scoredCoins.length / 2 ? 'ìƒìŠ¹ì¥' : 'ì¡°ì •ì¥'}
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px;">
                        <strong>ğŸ’¡ ì£¼ìš” ì¶”ì²œ ì´ìœ :</strong><br>
                        ${Array.from(new Set(scoredCoins.flatMap(item => item.reasons))).slice(0, 5).map(reason =>
                            `<span style="background: rgba(102, 126, 234, 0.3); padding: 3px 8px; border-radius: 3px; margin: 3px; display: inline-block; font-size: 0.85rem;">${reason}</span>`
                        ).join('')}
                    </div>
                </div>
            `;

            // ì„ íƒëœ ì½”ì¸ ìš”ì•½ ë°”ë¡œ ìœ„ì— í‘œì‹œ
            const selectedSummary = document.getElementById('selectedSummary');
            let aiSummary = document.getElementById('aiRecommendationSummary');

            if (!aiSummary) {
                aiSummary = document.createElement('div');
                aiSummary.id = 'aiRecommendationSummary';
                selectedSummary.parentNode.insertBefore(aiSummary, selectedSummary);
            }

            aiSummary.innerHTML = summaryHtml;
        }

        // ì „ì²´ ì„ íƒ
        function selectAllCoins() {
            document.querySelectorAll('input[id^="coin_"]').forEach(cb => cb.checked = true);
            updateSelectedCoins();
            addLog(`âœ… ì „ì²´ ì½”ì¸ ${upbitCoins.length}ê°œ ì„ íƒë¨`, 'success');
        }

        // ì „ì²´ í•´ì œ
        function clearAllCoins() {
            document.querySelectorAll('input[id^="coin_"]').forEach(cb => cb.checked = false);
            updateSelectedCoins();
        }

        // ì„ íƒëœ ì½”ì¸ ì—…ë°ì´íŠ¸
        function updateSelectedCoins() {
            const selected = Array.from(document.querySelectorAll('input[id^="coin_"]:checked'))
                                 .map(cb => cb.value);

            document.getElementById('selectedCount').textContent = selected.length;

            if (selected.length > 0) {
                document.getElementById('selectedSummary').style.display = 'block';

                const coinTags = selected.map(market => {
                    const coinName = market.replace('KRW-', '');
                    return `<span style="background: #007bff; padding: 4px 8px; border-radius: 4px; font-size: 0.9rem;">${coinName}</span>`;
                }).join('');

                document.getElementById('selectedCoins').innerHTML = coinTags;
            } else {
                document.getElementById('selectedSummary').style.display = 'none';
            }

            // ì„ íƒëœ ì½”ì¸ ëª¨ë‹ˆí„° ì—…ë°ì´íŠ¸
            updateSelectedCoinsMonitor();
        }

        // ì„ íƒëœ ì½”ì¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„° ì—…ë°ì´íŠ¸
        async function updateSelectedCoinsMonitor() {
            const selected = Array.from(document.querySelectorAll('input[id^="coin_"]:checked'))
                                 .map(cb => cb.value);

            const noSelectedCoins = document.getElementById('noSelectedCoins');
            const selectedCoinsGrid = document.getElementById('selectedCoinsGrid');

            if (selected.length === 0) {
                noSelectedCoins.style.display = 'block';
                selectedCoinsGrid.style.display = 'none';
                return;
            }

            noSelectedCoins.style.display = 'none';
            selectedCoinsGrid.style.display = 'grid';

            try {
                // ì„ íƒëœ ì½”ì¸ë“¤ì˜ ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ
                const symbols = selected.join(',');
                const response = await fetch(`https://api.upbit.com/v1/ticker?markets=${symbols}`);
                const tickers = await response.json();

                selectedCoinsGrid.innerHTML = tickers.map(ticker => {
                    const coin = upbitCoins.find(c => c.market === ticker.market);
                    const analysis = coinAnalysis[ticker.market] || {};
                    const marketData = analysis.marketData || {};
                    const indicators = analysis.indicators || {};

                    const changeColor = ticker.change === 'RISE' ? '#00ff00' :
                                       ticker.change === 'FALL' ? '#ff4444' : '#ccc';
                    const changeSign = ticker.change === 'RISE' ? '+' :
                                      ticker.change === 'FALL' ? '-' : '';

                    const coinName = ticker.market.replace('KRW-', '');
                    const koreanName = coin ? coin.korean_name : '';

                    return `
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <div style="font-size: 1.2rem; font-weight: bold;">${coinName}</div>
                                    <div style="font-size: 0.8rem; color: #ccc;">${koreanName}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 1.3rem; font-weight: bold;">â‚©${ticker.trade_price.toLocaleString()}</div>
                                    <div style="color: ${changeColor}; font-weight: bold;">
                                        ${changeSign}${(Math.abs(ticker.change_rate) * 100).toFixed(2)}%
                                    </div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.85rem;">
                                <div>
                                    <div style="color: #ccc;">ê³ ê°€</div>
                                    <div style="color: #ff4444;">â‚©${ticker.high_price.toLocaleString()}</div>
                                </div>
                                <div>
                                    <div style="color: #ccc;">ì €ê°€</div>
                                    <div style="color: #4444ff;">â‚©${ticker.low_price.toLocaleString()}</div>
                                </div>
                                <div>
                                    <div style="color: #ccc;">ê±°ë˜ëŸ‰</div>
                                    <div>â‚©${Math.round(ticker.acc_trade_price_24h / 1000000).toLocaleString()}M</div>
                                </div>
                                <div>
                                    <div style="color: #ccc;">ê±°ë˜ëŒ€ê¸ˆ</div>
                                    <div>${ticker.acc_trade_volume_24h.toFixed(2)}</div>
                                </div>
                            </div>

                            ${indicators.rsi ? `
                            <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.85rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>RSI:</span>
                                    <span style="font-weight: bold; color: ${
                                        indicators.rsi < 30 ? '#00ff00' :
                                        indicators.rsi > 70 ? '#ff4444' : '#ccc'
                                    }">${indicators.rsi.toFixed(1)}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>ì¶”ì„¸:</span>
                                    <span style="font-weight: bold; color: ${
                                        indicators.ma_trend === 'BULLISH' ? '#00ff00' :
                                        indicators.ma_trend === 'BEARISH' ? '#ff4444' : '#ccc'
                                    }">${indicators.ma_trend || 'NEUTRAL'}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>ì‹ í˜¸:</span>
                                    <span style="font-weight: bold; color: ${
                                        analysis.signal === 'BUY' ? '#00ff00' :
                                        analysis.signal === 'SELL' ? '#ff4444' : '#ccc'
                                    }">${analysis.signal || 'HOLD'}</span>
                                </div>
                            </div>
                            ` : ''}

                            <div style="margin-top: 10px; font-size: 0.75rem; color: #999;">
                                ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString()}
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('ì„ íƒëœ ì½”ì¸ ëª¨ë‹ˆí„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ì½”ì¸ ê²€ìƒ‰ í•„í„°
        function filterCoins() {
            const searchTerm = document.getElementById('coinSearch').value.toLowerCase();
            const rows = document.querySelectorAll('.coin-row');
            
            rows.forEach(row => {
                const market = row.dataset.market.toLowerCase();
                const visible = market.includes(searchTerm) || 
                               row.textContent.toLowerCase().includes(searchTerm);
                row.style.display = visible ? '' : 'none';
            });
        }

        // ì½”ì¸ ì •ë ¬
        function sortCoins() {
            const sortBy = document.getElementById('sortBy').value;
            
            upbitCoins.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.market.localeCompare(b.market);
                    case 'price':
                        return b.current_price - a.current_price;
                    case 'change':
                        return Math.abs(b.change_rate) - Math.abs(a.change_rate);
                    case 'volume':
                        return b.acc_trade_price_24h - a.acc_trade_price_24h;
                    default:
                        return 0;
                }
            });
            
            updateCoinTable();
        }

        // í¬ì§€ì…˜ í˜„í™© ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        async function updatePositionDisplay() {
            const positions = tradingBot.positions;
            const positionCount = Object.keys(positions).length;

            if (positionCount === 0) {
                document.getElementById('noPositions').style.display = 'block';
                document.getElementById('positionTable').style.display = 'none';
                document.getElementById('positionSummary').style.display = 'none';
                return;
            }

            document.getElementById('noPositions').style.display = 'none';
            document.getElementById('positionTable').style.display = 'block';
            document.getElementById('positionSummary').style.display = 'block';

            await updatePositionTable(positions);
            await updatePositionSummary(positions);
        }

        async function updatePositionTable(positions) {
            const tbody = document.getElementById('positionTableBody');
            tbody.innerHTML = '';

            // ì‹¤ì‹œê°„ ê°€ê²© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const symbols = Object.keys(positions).join(',');
            let currentPrices = {};

            try {
                if (symbols) {
                    const response = await fetch(`https://api.upbit.com/v1/ticker?markets=${symbols}`);
                    const tickers = await response.json();
                    tickers.forEach(ticker => {
                        currentPrices[ticker.market] = {
                            price: ticker.trade_price,
                            change: ticker.change,
                            change_rate: ticker.change_rate
                        };
                    });
                }
            } catch (error) {
                console.error('ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ ì‹¤íŒ¨:', error);
                // ì‹¤íŒ¨ì‹œ ì‹œë®¬ë ˆì´ì…˜ ê°€ê²© ì‚¬ìš©
                for (const symbol of Object.keys(positions)) {
                    const position = positions[symbol];
                    currentPrices[symbol] = {
                        price: position.avgPrice * (0.95 + Math.random() * 0.1),
                        change: 'EVEN',
                        change_rate: 0
                    };
                }
            }

            let totalInvested = 0, totalValue = 0;

            for (const [symbol, position] of Object.entries(positions)) {
                const row = document.createElement('tr');

                const priceInfo = currentPrices[symbol] || {
                    price: position.avgPrice,
                    change: 'EVEN',
                    change_rate: 0
                };
                const currentPrice = priceInfo.price;
                const quantity = position.quantity || 0;
                const avgPrice = position.avgPrice || 0;
                const invested = position.totalInvested || 0;
                const currentValue = quantity * currentPrice;
                const pnl = currentValue - invested;
                const pnlRate = invested > 0 ? (pnl / invested) * 100 : 0;

                totalInvested += invested;
                totalValue += currentValue;

                const pnlColor = pnl >= 0 ? '#00ff00' : '#ff4444';
                const changeColor = priceInfo.change === 'RISE' ? '#00ff00' :
                                   priceInfo.change === 'FALL' ? '#ff4444' : '#ccc';
                const coinName = symbol.replace('KRW-', '');

                // ë§¤ìˆ˜ ì´í›„ ê²½ê³¼ ì‹œê°„
                const entryTime = position.entryTime ? new Date(position.entryTime) : new Date();
                const holdingTime = Math.floor((new Date() - entryTime) / 1000 / 60); // ë¶„ ë‹¨ìœ„

                row.innerHTML = `
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="font-weight: bold; font-size: 1.1rem;">${coinName}</div>
                        <div style="font-size: 0.75rem; color: #999;">ë³´ìœ  ${holdingTime}ë¶„</div>
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">${quantity.toFixed(8)}</td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">
                        <div>â‚©${avgPrice.toLocaleString()}</div>
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="font-weight: bold;">â‚©${currentPrice.toLocaleString()}</div>
                        <div style="color: ${changeColor}; font-size: 0.85rem;">
                            ${priceInfo.change === 'RISE' ? 'â–²' : priceInfo.change === 'FALL' ? 'â–¼' : 'â”'}
                            ${(Math.abs(priceInfo.change_rate) * 100).toFixed(2)}%
                        </div>
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">â‚©${invested.toLocaleString()}</td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="font-weight: bold;">â‚©${Math.round(currentValue).toLocaleString()}</div>
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2); color: ${pnlColor}; font-weight: bold;">
                        <div>â‚©${Math.round(pnl).toLocaleString()}</div>
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2); color: ${pnlColor}; font-weight: bold; font-size: 1.1rem;">
                        ${pnlRate >= 0 ? '+' : ''}${pnlRate.toFixed(2)}%
                    </td>
                    <td style="padding: 8px; border: 1px solid rgba(255,255,255,0.2);">
                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.85rem; width: 100%;" onclick="sellPosition('${symbol}')">ë§¤ë„</button>
                    </td>
                `;

                tbody.appendChild(row);
            }
        }

        async function updatePositionSummary(positions) {
            // ì‹¤ì‹œê°„ ê°€ê²© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const symbols = Object.keys(positions).join(',');
            let currentPrices = {};

            try {
                if (symbols) {
                    const response = await fetch(`https://api.upbit.com/v1/ticker?markets=${symbols}`);
                    const tickers = await response.json();
                    tickers.forEach(ticker => {
                        currentPrices[ticker.market] = ticker.trade_price;
                    });
                }
            } catch (error) {
                console.error('ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ ì‹¤íŒ¨:', error);
            }

            let totalInvested = 0, totalValue = 0;

            for (const [symbol, position] of Object.entries(positions)) {
                const currentPrice = currentPrices[symbol] || position.avgPrice;
                const quantity = position.quantity || 0;
                const invested = position.totalInvested || 0;
                const currentValue = quantity * currentPrice;

                totalInvested += invested;
                totalValue += currentValue;
            }

            const totalPnL = totalValue - totalInvested;
            const totalPnLRate = totalInvested > 0 ? (totalPnL / totalInvested) * 100 : 0;

            document.getElementById('totalInvested').textContent = `â‚©${Math.round(totalInvested).toLocaleString()}`;
            document.getElementById('totalValue').textContent = `â‚©${Math.round(totalValue).toLocaleString()}`;

            const pnlElement = document.getElementById('totalPnL');
            const pnlRateElement = document.getElementById('totalPnLRate');

            pnlElement.textContent = `â‚©${Math.round(totalPnL).toLocaleString()}`;
            pnlRateElement.textContent = `${totalPnLRate >= 0 ? '+' : ''}${totalPnLRate.toFixed(2)}%`;

            const color = totalPnL >= 0 ? 'profit-positive' : 'profit-negative';
            pnlElement.className = `status-value ${color}`;
            pnlRateElement.className = `status-value ${color}`;
        }

        function sellPosition(symbol) {
            if (!confirm(`${symbol.replace('KRW-', '')} í¬ì§€ì…˜ì„ ë§¤ë„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            if (tradingBot.positions[symbol]) {
                const position = tradingBot.positions[symbol];
                const currentPrice = position.avgPrice * (0.95 + Math.random() * 0.1);
                const pnl = (position.quantity * currentPrice) - position.totalInvested;
                
                delete tradingBot.positions[symbol];
                tradingBot.balance += (position.quantity * currentPrice);
                tradingBot.dailyPnL += pnl / tradingBot.initialBalance;
                
                addLog(`ğŸ’° ${symbol.replace('KRW-', '')} í¬ì§€ì…˜ ë§¤ë„ ì™„ë£Œ (${pnl > 0 ? '+' : ''}${pnl.toLocaleString()}ì›)`, 
                       pnl > 0 ? 'success' : 'error');
                
                updatePositionDisplay();
                updateDisplay();
            }
        }

        function sendConfigToServer(config) {
            console.log('ì„œë²„ë¡œ ì„¤ì • ì „ì†¡:', config);
        }

        // API í‚¤ ì €ì¥
        function saveApiKeys() {
            const accessKey = document.getElementById('accessKey').value;
            const secretKey = document.getElementById('secretKey').value;
            
            if (!accessKey || !secretKey) {
                alert('API í‚¤ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            localStorage.setItem('upbit_access_key', btoa(accessKey));
            localStorage.setItem('upbit_secret_key', btoa(secretKey));
            
            document.getElementById('apiStatus').innerHTML = 
                '<div style="color: #00ff00;">âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
            
            addLog('API í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testConnection() {
            const accessKey = document.getElementById('accessKey').value;
            const secretKey = document.getElementById('secretKey').value;
            
            if (!accessKey || !secretKey) {
                alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            document.getElementById('apiStatus').innerHTML = 
                '<div style="color: #ffc107;">â³ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            setTimeout(() => {
                const isValid = Math.random() > 0.3;
                
                if (isValid) {
                    document.getElementById('apiStatus').innerHTML = 
                        '<div style="color: #00ff00;">âœ… ì—°ê²° ì„±ê³µ! API í‚¤ê°€ ìœ íš¨í•©ë‹ˆë‹¤.</div>';
                    addLog('ì—…ë¹„íŠ¸ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                } else {
                    document.getElementById('apiStatus').innerHTML = 
                        '<div style="color: #ff4444;">âŒ ì—°ê²° ì‹¤íŒ¨. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</div>';
                    addLog('ì—…ë¹„íŠ¸ API ì—°ê²° ì‹¤íŒ¨', 'error');
                }
            }, 2000);
        }

        // í…”ë ˆê·¸ë¨ ì„¤ì • ì €ì¥
        function saveTelegramConfig() {
            const token = document.getElementById('telegramToken').value;
            const chatId = document.getElementById('telegramChatId').value;
            
            if (!token || !chatId) {
                alert('í…”ë ˆê·¸ë¨ ë´‡ í† í°ê³¼ ì±„íŒ… IDë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            localStorage.setItem('telegram_token', btoa(token));
            localStorage.setItem('telegram_chat_id', btoa(chatId));
            
            addLog('í…”ë ˆê·¸ë¨ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            alert('í…”ë ˆê·¸ë¨ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸
        async function testTelegram() {
            const token = document.getElementById('telegramToken').value;
            const chatId = document.getElementById('telegramChatId').value;
            
            if (!token || !chatId) {
                alert('í…”ë ˆê·¸ë¨ ì„¤ì •ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            addLog('í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ì¤‘...', 'info');
            
            setTimeout(() => {
                const success = Math.random() > 0.2;
                if (success) {
                    addLog('âœ… í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ', 'success');
                    alert('í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    addLog('âŒ í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨', 'error');
                    alert('ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            }, 1500);
        }

        // ê±°ë˜ ì‹œì‘
        function startTrading() {
            if (tradingBot.isRunning) {
                alert('ê±°ë˜ê°€ ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }

            const accessKey = localStorage.getItem('upbit_access_key');
            if (!accessKey) {
                alert('ë¨¼ì € ì—…ë¹„íŠ¸ API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }

            tradingBot.isRunning = true;
            tradingBot.initialBalance = parseFloat(document.getElementById('initialAmount').value);
            tradingBot.balance = tradingBot.initialBalance;
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('tradingStatus').textContent = 'ì‹¤í–‰ ì¤‘';
            
            addLog('ğŸš€ ìë™ë§¤ë§¤ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            
            startRealTimeUpdate();
            
            if (document.getElementById('claudeEmergencyMode').checked) {
                startClaudeMonitoring();
            }
            
            startTelegramNotifications();
        }

        // ê±°ë˜ ì¤‘ì§€
        function stopTrading() {
            tradingBot.isRunning = false;
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('tradingStatus').textContent = 'ì¤‘ì§€ë¨';
            
            addLog('â¹ï¸ ìë™ë§¤ë§¤ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
            
            sendTelegramMessage('ğŸ›‘ ìë™ë§¤ë§¤ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì¼ì‹œ ì •ì§€
        function pauseTrading() {
            if (tradingBot.isRunning) {
                tradingBot.isPaused = !tradingBot.isPaused;
                const status = tradingBot.isPaused ? 'ì¼ì‹œì •ì§€' : 'ì‹¤í–‰ ì¤‘';
                document.getElementById('tradingStatus').textContent = status;
                addLog(`â¸ï¸ ê±°ë˜ê°€ ${status}ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'warning');
            }
        }

        // ê¸´ê¸‰ ë§¤ë„
        function emergencySell() {
            if (!confirm('ëª¨ë“  í¬ì§€ì…˜ì„ ê¸´ê¸‰ ë§¤ë„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            addLog('ğŸš¨ ê¸´ê¸‰ ë§¤ë„ ì‹¤í–‰ ì¤‘...', 'error');
            
            setTimeout(() => {
                tradingBot.positions = {};
                updateDisplay();
                updatePositionDisplay();
                addLog('âœ… ëª¨ë“  í¬ì§€ì…˜ì´ ë§¤ë„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
                sendTelegramMessage('ğŸš¨ ê¸´ê¸‰ ë§¤ë„ ì™„ë£Œ\nëª¨ë“  í¬ì§€ì…˜ì´ ì²­ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }, 2000);
        }

        // ì¼ì¼ ë¦¬ì…‹
        function resetDaily() {
            if (!confirm('ì¼ì¼ ìˆ˜ìµë¥ ì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            tradingBot.dailyPnL = 0;
            tradingBot.initialBalance = tradingBot.balance;
            updateDisplay();
            
            addLog('ğŸ”„ ì¼ì¼ ìˆ˜ìµë¥ ì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // Claude ìˆ˜ë™ ë¶„ì„
        function claudeManualAnalysis() {
            addLog('ğŸ¤– Claude AI ë¶„ì„ ìš”ì²­ ì¤‘...', 'info');
            
            setTimeout(() => {
                const recommendations = [
                    'í˜„ì¬ ì‹œì¥ ìƒí™©ì´ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤. ë³´ìˆ˜ì  ì ‘ê·¼ì„ ê¶Œì¥í•©ë‹ˆë‹¤.',
                    'XRPì—ì„œ ê°•í•œ ë§¤ìˆ˜ ì‹ í˜¸ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    'BTC ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ì´ 3.2%ë¡œ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.',
                    'ì „ì²´ì ì¸ ê±°ë˜ëŸ‰ì´ ì¦ê°€í•˜ê³  ìˆì–´ ë³€ë™ì„± í™•ëŒ€ ì˜ˆìƒë©ë‹ˆë‹¤.'
                ];
                
                const randomRec = recommendations[Math.floor(Math.random() * recommendations.length)];
                addLog(`ğŸ¤– Claude ë¶„ì„: ${randomRec}`, 'info');
                
                sendTelegramMessage(`ğŸ¤– Claude AI ë¶„ì„ ê²°ê³¼:\n${randomRec}`);
            }, 1500);
        }

        // Claude ê¸´ê¸‰ ì¤‘ì§€
        function claudeEmergencyStop() {
            if (!confirm('Claude AIê°€ ê¸´ê¸‰ ì¤‘ì§€ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            stopTrading();
            addLog('ğŸ¤– Claude AIì— ì˜í•œ ê¸´ê¸‰ ì¤‘ì§€ ì‹¤í–‰', 'error');
            sendTelegramMessage('ğŸš¨ Claude AI ê¸´ê¸‰ ì¤‘ì§€\nìœ„í—˜ ìš”ì†Œ ê°ì§€ë¡œ ê±°ë˜ê°€ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
        function startRealTimeUpdate() {
            setInterval(() => {
                if (!tradingBot.isRunning || tradingBot.isPaused) return;
                
                simulateTrading();
                updateDisplay();
                updateChart();
                checkDailyLimits();
                
                tradingBot.lastUpdate = new Date();
            }, 5000);
        }

        // ê°€ìƒ ê±°ë˜ ì‹œë®¬ë ˆì´ì…˜
        function simulateTrading() {
            const includeFees = document.getElementById('includeFeesToggle').checked;
            const feeRate = includeFees ? 0.0005 : 0;
            
            if (Math.random() > 0.9) {
                const coins = ['KRW-BTC', 'KRW-ETH', 'KRW-XRP', 'KRW-ADA'];
                const symbol = coins[Math.floor(Math.random() * coins.length)];
                const action = Math.random() > 0.5 ? 'BUY' : 'SELL';
                
                if (action === 'BUY') {
                    const amount = Math.random() * 50000 + 10000;
                    const price = Math.random() * 100000 + 50000;
                    const quantity = amount / price;
                    
                    if (tradingBot.positions[symbol]) {
                        const pos = tradingBot.positions[symbol];
                        const newQuantity = pos.quantity + quantity;
                        const newInvested = pos.totalInvested + amount;
                        pos.avgPrice = newInvested / newQuantity;
                        pos.quantity = newQuantity;
                        pos.totalInvested = newInvested;
                    } else {
                        tradingBot.positions[symbol] = {
                            quantity: quantity,
                            avgPrice: price,
                            totalInvested: amount,
                            entryTime: new Date()
                        };
                    }
                    
                    tradingBot.balance -= amount;
                    addLog(`ğŸ“ˆ ë§¤ìˆ˜: ${symbol.replace('KRW-', '')} ${amount.toLocaleString()}ì›`, 'success');
                    updatePositionDisplay();
                    
                } else if (tradingBot.positions[symbol]) {
                    const pos = tradingBot.positions[symbol];
                    const currentPrice = pos.avgPrice * (0.9 + Math.random() * 0.2);
                    const sellValue = pos.quantity * currentPrice;
                    const pnl = sellValue - pos.totalInvested;
                    
                    tradingBot.balance += sellValue;
                    tradingBot.dailyPnL += pnl / tradingBot.initialBalance;
                    delete tradingBot.positions[symbol];
                    
                    addLog(`ğŸ“‰ ë§¤ë„: ${symbol.replace('KRW-', '')} ${pnl > 0 ? '+' : ''}${pnl.toLocaleString()}ì›`, 
                           pnl > 0 ? 'success' : 'error');
                    updatePositionDisplay();
                }
            }
        }

        // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            document.getElementById('currentBalance').textContent = 
                `â‚©${tradingBot.balance.toLocaleString()}`;
            
            const dailyPnLPercent = (tradingBot.dailyPnL * 100).toFixed(2);
            const pnlElement = document.getElementById('dailyPnL');
            pnlElement.textContent = `${dailyPnLPercent >= 0 ? '+' : ''}${dailyPnLPercent}%`;
            pnlElement.className = dailyPnLPercent >= 0 ? 'status-value profit-positive' : 'status-value profit-negative';
            
            document.getElementById('activePositions').textContent = 
                Object.keys(tradingBot.positions).length;
            
            document.getElementById('lastUpdate').textContent = 
                tradingBot.lastUpdate.toLocaleTimeString();
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateChart() {
            const now = new Date();
            const timeLabel = now.toLocaleTimeString();
            const profitPercent = tradingBot.dailyPnL * 100;
            
            chartData.labels.push(timeLabel);
            chartData.datasets[0].data.push(profitPercent);
            
            if (chartData.labels.length > 50) {
                chartData.labels.shift();
                chartData.datasets[0].data.shift();
            }
            
            chartData.datasets[0].borderColor = profitPercent >= 0 ? '#00ff00' : '#ff4444';
            chartData.datasets[0].backgroundColor = profitPercent >= 0 ? 'rgba(0, 255, 0, 0.1)' : 'rgba(255, 68, 68, 0.1)';
            
            profitChart.update('none');
        }

        // ì¼ì¼ í•œë„ ì²´í¬
        function checkDailyLimits() {
            const maxProfit = parseFloat(document.getElementById('maxDailyProfit').value) / 100;
            const maxLoss = parseFloat(document.getElementById('maxDailyLoss').value) / 100;
            
            if (tradingBot.dailyPnL >= maxProfit) {
                stopTrading();
                addLog(`ğŸ‰ ì¼ì¼ ìˆ˜ìµ ëª©í‘œ ë‹¬ì„±! (${(tradingBot.dailyPnL * 100).toFixed(2)}%)`, 'success');
                sendTelegramMessage(`ğŸ‰ ì¼ì¼ ìˆ˜ìµ ëª©í‘œ ë‹¬ì„±!\nìˆ˜ìµë¥ : ${(tradingBot.dailyPnL * 100).toFixed(2)}%\nìë™ë§¤ë§¤ê°€ ì¤‘ì§€ë©ë‹ˆë‹¤.`);
            } else if (tradingBot.dailyPnL <= -maxLoss) {
                stopTrading();
                addLog(`ğŸ›‘ ì¼ì¼ ì†ì‹¤ í•œë„ ë„ë‹¬! (${(tradingBot.dailyPnL * 100).toFixed(2)}%)`, 'error');
                sendTelegramMessage(`ğŸ›‘ ì¼ì¼ ì†ì‹¤ í•œë„ ë„ë‹¬!\nì†ì‹¤ë¥ : ${(tradingBot.dailyPnL * 100).toFixed(2)}%\nìë™ë§¤ë§¤ê°€ ì¤‘ì§€ë©ë‹ˆë‹¤.`);
            }
        }

        // Claude ëª¨ë‹ˆí„°ë§ ì‹œì‘
        function startClaudeMonitoring() {
            const interval = parseInt(document.getElementById('claudeIntervalSelect').value);
            
            setInterval(() => {
                if (!tradingBot.isRunning) return;
                
                const riskScore = Math.random();
                const riskThreshold = parseFloat(document.getElementById('riskThreshold').value);
                
                if (riskScore > riskThreshold) {
                    const actions = [
                        'í¬ì§€ì…˜ í¬ê¸° ì¶•ì†Œ ê¶Œì¥',
                        'ë³€ë™ì„± ì¦ê°€ë¡œ ì£¼ì˜ í•„ìš”',
                        'ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ í•˜ë½ ê°ì§€',
                        'ê±°ë˜ëŸ‰ ê¸‰ì¦ìœ¼ë¡œ ê´€ë§ ê¶Œì¥'
                    ];
                    
                    const action = actions[Math.floor(Math.random() * actions.length)];
                    addLog(`ğŸ¤– Claude ìë™ ë¶„ì„: ${action}`, 'warning');
                    
                    if (Math.random() > 0.8) {
                        addLog('ğŸ¤– Claudeê°€ ìë™ìœ¼ë¡œ ê°œì…í–ˆìŠµë‹ˆë‹¤.', 'error');
                        sendTelegramMessage(`ğŸ¤– Claude ìë™ ê°œì…\nì‚¬ìœ : ${action}`);
                    }
                }
            }, interval * 60 * 1000);
        }

        // í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì‹œì‘
        function startTelegramNotifications() {
            const interval = parseInt(document.getElementById('notificationInterval').value);
            
            setInterval(() => {
                if (!tradingBot.isRunning) return;
                
                const notifyProfitLoss = document.getElementById('notifyProfitLoss').checked;
                
                if (notifyProfitLoss) {
                    const message = generateTelegramReport();
                    sendTelegramMessage(message);
                }
            }, interval * 60 * 1000);
        }

        // í…”ë ˆê·¸ë¨ ë¦¬í¬íŠ¸ ìƒì„±
        function generateTelegramReport() {
            const profitPercent = (tradingBot.dailyPnL * 100).toFixed(2);
            const profitAmount = (tradingBot.balance - tradingBot.initialBalance).toLocaleString();
            const positionCount = Object.keys(tradingBot.positions).length;
            
            const emoji = tradingBot.dailyPnL >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const sign = tradingBot.dailyPnL >= 0 ? '+' : '';
            
            return `${emoji} ìë™ë§¤ë§¤ í˜„í™© ë¦¬í¬íŠ¸
            
ğŸ’° í˜„ì¬ ì”ê³ : â‚©${tradingBot.balance.toLocaleString()}
ğŸ“Š ì¼ì¼ ì†ìµ: ${sign}${profitPercent}% (${sign}â‚©${profitAmount})
ğŸ¯ í™œì„± í¬ì§€ì…˜: ${positionCount}ê°œ
â° ì‹œê°„: ${new Date().toLocaleString()}

${tradingBot.dailyPnL >= 0 ? 'âœ… ìˆœì¡°ë¡­ê²Œ ìˆ˜ìµ ì¤‘ì…ë‹ˆë‹¤!' : 'âš ï¸ ì†ì‹¤ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì£¼ì˜í•˜ì„¸ìš”.'}`;
        }

        // í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
        async function sendTelegramMessage(message) {
            const token = localStorage.getItem('telegram_token');
            const chatId = localStorage.getItem('telegram_chat_id');
            
            if (!token || !chatId) return;
            
            try {
                console.log('í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡:', message);
                addLog('ğŸ“± í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ', 'info');
            } catch (error) {
                addLog('ğŸ“± í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨', 'error');
            }
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            logContainer.insertBefore(logEntry, logContainer.firstChild);
            
            while (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // ê³ ê¸‰ ì„¤ì • ì €ì¥
        function saveAdvancedSettings() {
            const settings = {
                maxPositions: document.getElementById('maxPositionsModal').value,
                maxPositionSize: document.getElementById('maxPositionSizeModal').value,
                stopLossRate: document.getElementById('stopLossRateModal').value
            };
            
            localStorage.setItem('advanced_settings', JSON.stringify(settings));
            addLog('ê³ ê¸‰ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            closeModal('settingsModal');
        }

        // ëª¨ë‹¬ ì°½ ë‹«ê¸°
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ì„¤ì •ê°’ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSettings() {
            const accessKey = localStorage.getItem('upbit_access_key');
            const secretKey = localStorage.getItem('upbit_secret_key');
            
            if (accessKey) {
                document.getElementById('accessKey').value = atob(accessKey);
            }
            if (secretKey) {
                document.getElementById('secretKey').value = atob(secretKey);
            }
            
            const telegramToken = localStorage.getItem('telegram_token');
            const telegramChatId = localStorage.getItem('telegram_chat_id');
            
            if (telegramToken) {
                document.getElementById('telegramToken').value = atob(telegramToken);
            }
            if (telegramChatId) {
                document.getElementById('telegramChatId').value = atob(telegramChatId);
            }
            
            const advancedSettings = localStorage.getItem('advanced_settings');
            if (advancedSettings) {
                const settings = JSON.parse(advancedSettings);
                document.getElementById('maxPositionsModal').value = settings.maxPositions || 4;
                document.getElementById('maxPositionSizeModal').value = settings.maxPositionSize || 25;
                document.getElementById('stopLossRateModal').value = settings.stopLossRate || 1;
            }
        }

        // ë¦¬ìŠ¤í¬ ì„ê³„ê°’ ìŠ¬ë¼ì´ë” ì—…ë°ì´íŠ¸
        document.getElementById('riskThreshold').addEventListener('input', function() {
            document.getElementById('riskThresholdValue').textContent = this.value;
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        if (tradingBot.isRunning) {
                            stopTrading();
                        } else {
                            startTrading();
                        }
                        break;
                    case 'e':
                        e.preventDefault();
                        emergencySell();
                        break;
                    case 'r':
                        e.preventDefault();
                        resetDaily();
                        break;
                }
            }
        });

        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ ê²½ê³ 
        window.addEventListener('beforeunload', function(e) {
            if (tradingBot.isRunning) {
                e.preventDefault();
                e.returnValue = 'ê±°ë˜ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì •ë§ í˜ì´ì§€ë¥¼ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?';
            }
        });

        // ì½”ì¸ ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
        setInterval(async () => {
            if (upbitCoins.length > 0) {
                try {
                    const symbols = upbitCoins.map(c => c.market).join(',');
                    const response = await fetch(`https://api.upbit.com/v1/ticker?markets=${symbols}`);
                    const tickers = await response.json();
                    
                    tickers.forEach(ticker => {
                        const coin = upbitCoins.find(c => c.market === ticker.market);
                        if (coin) {
                            coin.current_price = ticker.trade_price;
                            coin.change_rate = ticker.change_rate;
                            coin.change = ticker.change;
                        }
                    });
                    
                    updateCoinTable();
                    
                } catch (error) {
                    console.error('ì½”ì¸ ê°€ê²© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                }
            }
        }, 300000); // 5ë¶„ë§ˆë‹¤

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        window.addEventListener('load', async function() {
            initChart();
            loadSettings();
            loadTradingConfig();
            updateDisplay();
            updatePositionDisplay();

            // ì½”ì¸ ëª©ë¡ ìë™ ë¡œë“œ
            addLog('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...', 'info');
            await loadUpbitCoins();

            // í¬ì§€ì…˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            setInterval(() => {
                updatePositionDisplay();
            }, 3000);

            // ì„ íƒëœ ì½”ì¸ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            setInterval(() => {
                updateSelectedCoinsMonitor();
            }, 5000);

            addLog('âœ… ì—…ë¹„íŠ¸ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            addLog('ğŸ’¡ íŒ: ë¨¼ì € API í‚¤ë¥¼ ì„¤ì •í•˜ê³  ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.', 'info');
        });

    </script>
</body>
</html>